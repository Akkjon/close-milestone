{"version":3,"file":"index.js","sources":["../dist-src/get-oauth-access-token.js","../dist-src/auth.js","../dist-src/requires-basic-auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAccessToken(state, options) {\n    const authOptionsPassed = options.auth\n        ? typeof options.auth.code !== \"undefined\"\n        : false;\n    const authOptions = options.auth && authOptionsPassed ? options.auth : state;\n    if (state.token && !authOptionsPassed) {\n        return state.token;\n    }\n    // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n    // instead it’s using the github.com domain.\n    const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n        ? \"POST https://github.com/login/oauth/access_token\"\n        : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n    const request = options.request || state.request;\n    const parameters = {\n        headers: {\n            accept: \"application/json\",\n        },\n        client_id: state.clientId,\n        client_secret: state.clientSecret,\n        code: authOptions.code,\n        redirect_uri: authOptions.redirectUrl,\n        state: authOptions.state,\n    };\n    const response = await request(route, parameters);\n    if (response.data.error !== undefined) {\n        throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n            headers: response.headers,\n            request: request.endpoint(route, parameters),\n        });\n    }\n    const { data } = response;\n    const newToken = {\n        token: data.access_token,\n        scopes: data.scope.split(/,\\s*/).filter(Boolean),\n    };\n    if (!authOptionsPassed) {\n        state.token = newToken;\n    }\n    return newToken;\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nexport async function auth(state, authOptions) {\n    if (authOptions.type === \"token\") {\n        const { token, scopes } = await getOAuthAccessToken(state, {\n            auth: authOptions\n        });\n        return {\n            type: \"token\",\n            token,\n            tokenType: \"oauth\",\n            scopes\n        };\n    }\n    return {\n        type: \"oauth-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        headers: {\n            authorization: `basic ${btoa(`${state.clientId}:${state.clientSecret}`)}`\n        }\n    };\n}\n","/**\n * The following endpoints require an OAuth App to authenticate using its client_id and client_secret.\n *\n * - [`POST /applications/{client_id}/token`](https://developer.github.com/v3/apps/oauth_applications/#check-a-token) - Check a token\n * - [`PATCH /applications/{client_id}/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Reset a token\n * - [`DELETE /applications/{client_id}/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Delete an app token\n * - [`DELETE /applications/{client_id}/grant`](https://developer.github.com/v3/apps/oauth_applications/#delete-an-app-authorization) - Delete an app authorization\n *\n * deprecated:\n *\n * - [`GET /applications/{client_id}/tokens/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#check-an-authorization) - Check an authorization\n * - [`POST /applications/{client_id}/tokens/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#reset-an-authorization) - Reset an authorization\n * - [`DELETE /applications/{client_id}/tokens/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#revoke-an-authorization-for-an-application) - Revoke an authorization for an application\n * - [`DELETE /applications/{client_id}/grants/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#revoke-a-grant-for-an-application) - Revoke a grant for an application\n */\nconst ROUTES_REQUIRING_BASIC_AUTH = /\\/applications\\/[:{]?[\\w_]+\\}?\\/(token|grant)(s\\/[:{]?[\\w_]+\\}?)?($|\\?)/;\nexport function requiresBasicAuth(url) {\n    return url && ROUTES_REQUIRING_BASIC_AUTH.test(url);\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    // Do not intercept request to retrieve a new token\n    if (/\\/login\\/oauth\\/access_token$/.test(endpoint.url)) {\n        return request(endpoint);\n    }\n    if (!state.code || requiresBasicAuth(endpoint.url)) {\n        const credentials = btoa(`${state.clientId}:${state.clientSecret}`);\n        endpoint.headers.authorization = `basic ${credentials}`;\n        const response = await request(endpoint);\n        // `POST /applications/{client_id}/tokens/{access_token}` (legacy) or\n        // `PATCH /applications/{client_id}/token` resets the passed token\n        // and returns a new one. If that’s the current request then update internal state.\n        // Regex supports both the `{param}` as well as the legacy `:param` notation\n        const isLegacyTokenResetRequest = endpoint.method === \"POST\" &&\n            /^\\/applications\\/[:{]?[\\w_]+\\}?\\/tokens\\/[:{]?[\\w_]+\\}?$/.test(endpoint.url);\n        const isTokenResetRequest = endpoint.method === \"PATCH\" &&\n            /^\\/applications\\/[:{]?[\\w_]+\\}?\\/token$/.test(endpoint.url);\n        if (isLegacyTokenResetRequest || isTokenResetRequest) {\n            state.token = {\n                token: response.data.token,\n                // @ts-ignore figure this out\n                scope: response.data.scopes,\n            };\n        }\n        return response;\n    }\n    const { token } = await getOAuthAccessToken(state, { request });\n    endpoint.headers.authorization = `token ${token}`;\n    return request(endpoint);\n}\n","export const VERSION = \"3.0.8\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { VERSION } from \"./version\";\nexport function createOAuthAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-oauth-app.js/${VERSION} ${getUserAgent()}`\n            }\n        })\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state)\n    });\n}\n"],"names":["getOAuthAccessToken","state","options","authOptionsPassed","auth","code","authOptions","token","route","test","request","endpoint","DEFAULTS","baseUrl","replace","parameters","headers","accept","client_id","clientId","client_secret","clientSecret","redirect_uri","redirectUrl","response","data","error","undefined","RequestError","error_description","status","newToken","access_token","scopes","scope","split","filter","Boolean","type","tokenType","authorization","btoa","ROUTES_REQUIRING_BASIC_AUTH","requiresBasicAuth","url","hook","merge","credentials","isLegacyTokenResetRequest","method","isTokenResetRequest","VERSION","createOAuthAppAuth","Object","assign","defaults","getUserAgent","bind"],"mappings":"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"}