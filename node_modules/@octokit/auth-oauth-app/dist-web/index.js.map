{"version":3,"file":"index.js","sources":["../dist-src/get-oauth-access-token.js","../dist-src/auth.js","../dist-src/requires-basic-auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAccessToken(state, options) {\n    const authOptionsPassed = options.auth\n        ? typeof options.auth.code !== \"undefined\"\n        : false;\n    const authOptions = options.auth && authOptionsPassed ? options.auth : state;\n    if (state.token && !authOptionsPassed) {\n        return state.token;\n    }\n    // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n    // instead it’s using the github.com domain.\n    const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n        ? \"POST https://github.com/login/oauth/access_token\"\n        : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n    const request = options.request || state.request;\n    const parameters = {\n        headers: {\n            accept: \"application/json\",\n        },\n        client_id: state.clientId,\n        client_secret: state.clientSecret,\n        code: authOptions.code,\n        redirect_uri: authOptions.redirectUrl,\n        state: authOptions.state,\n    };\n    const response = await request(route, parameters);\n    if (response.data.error !== undefined) {\n        throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n            headers: response.headers,\n            request: request.endpoint(route, parameters),\n        });\n    }\n    const { data } = response;\n    const newToken = {\n        token: data.access_token,\n        scopes: data.scope.split(/,\\s*/).filter(Boolean),\n    };\n    if (!authOptionsPassed) {\n        state.token = newToken;\n    }\n    return newToken;\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nexport async function auth(state, authOptions) {\n    if (authOptions.type === \"token\") {\n        const { token, scopes } = await getOAuthAccessToken(state, {\n            auth: authOptions\n        });\n        return {\n            type: \"token\",\n            token,\n            tokenType: \"oauth\",\n            scopes\n        };\n    }\n    return {\n        type: \"oauth-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        headers: {\n            authorization: `basic ${btoa(`${state.clientId}:${state.clientSecret}`)}`\n        }\n    };\n}\n","/**\n * The following endpoints require an OAuth App to authenticate using its client_id and client_secret.\n *\n * - [`POST /applications/{client_id}/token`](https://developer.github.com/v3/apps/oauth_applications/#check-a-token) - Check a token\n * - [`PATCH /applications/{client_id}/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Reset a token\n * - [`DELETE /applications/{client_id}/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Delete an app token\n * - [`DELETE /applications/{client_id}/grant`](https://developer.github.com/v3/apps/oauth_applications/#delete-an-app-authorization) - Delete an app authorization\n *\n * deprecated:\n *\n * - [`GET /applications/{client_id}/tokens/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#check-an-authorization) - Check an authorization\n * - [`POST /applications/{client_id}/tokens/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#reset-an-authorization) - Reset an authorization\n * - [`DELETE /applications/{client_id}/tokens/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#revoke-an-authorization-for-an-application) - Revoke an authorization for an application\n * - [`DELETE /applications/{client_id}/grants/{access_token}`](https://developer.github.com/v3/apps/oauth_applications/#revoke-a-grant-for-an-application) - Revoke a grant for an application\n */\nconst ROUTES_REQUIRING_BASIC_AUTH = /\\/applications\\/[:{]?[\\w_]+\\}?\\/(token|grant)(s\\/[:{]?[\\w_]+\\}?)?($|\\?)/;\nexport function requiresBasicAuth(url) {\n    return url && ROUTES_REQUIRING_BASIC_AUTH.test(url);\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    // Do not intercept request to retrieve a new token\n    if (/\\/login\\/oauth\\/access_token$/.test(endpoint.url)) {\n        return request(endpoint);\n    }\n    if (!state.code || requiresBasicAuth(endpoint.url)) {\n        const credentials = btoa(`${state.clientId}:${state.clientSecret}`);\n        endpoint.headers.authorization = `basic ${credentials}`;\n        const response = await request(endpoint);\n        // `POST /applications/{client_id}/tokens/{access_token}` (legacy) or\n        // `PATCH /applications/{client_id}/token` resets the passed token\n        // and returns a new one. If that’s the current request then update internal state.\n        // Regex supports both the `{param}` as well as the legacy `:param` notation\n        const isLegacyTokenResetRequest = endpoint.method === \"POST\" &&\n            /^\\/applications\\/[:{]?[\\w_]+\\}?\\/tokens\\/[:{]?[\\w_]+\\}?$/.test(endpoint.url);\n        const isTokenResetRequest = endpoint.method === \"PATCH\" &&\n            /^\\/applications\\/[:{]?[\\w_]+\\}?\\/token$/.test(endpoint.url);\n        if (isLegacyTokenResetRequest || isTokenResetRequest) {\n            state.token = {\n                token: response.data.token,\n                // @ts-ignore figure this out\n                scope: response.data.scopes,\n            };\n        }\n        return response;\n    }\n    const { token } = await getOAuthAccessToken(state, { request });\n    endpoint.headers.authorization = `token ${token}`;\n    return request(endpoint);\n}\n","export const VERSION = \"3.0.8\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { VERSION } from \"./version\";\nexport function createOAuthAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-oauth-app.js/${VERSION} ${getUserAgent()}`\n            }\n        })\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state)\n    });\n}\n"],"names":[],"mappings":"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"}